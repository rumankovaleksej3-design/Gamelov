<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Telegram Web</title>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --primary-bg: #0a1625;
  --secondary-bg: #17212b;
  --message-bg: #182533;
  --my-message-bg: #2b5278;
  --border-color: #2a3b52;
  --text-primary: #e6eaee;
  --text-secondary: #8a9aa9;
  --accent-color: #3b82f6;
  --online-color: #22c55e;
  --unread-color: #3b82f6;
  --hover-bg: #1e2a38;
  --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  --danger: #ef4444;
  --success: #22c55e;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--primary-bg);
  color: var(--text-primary);
  height: 100vh;
  overflow: hidden;
}

.hidden { display: none !important; }

.container {
  display: flex;
  height: 100vh;
  max-width: 1400px;
  margin: 0 auto;
}

/* SIDEBAR */
.sidebar {
  width: 320px;
  background: var(--secondary-bg);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease;
}

.sidebar-header {
  padding: 15px 20px;
  background: var(--secondary-bg);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sidebar-header .user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--accent-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 500;
}

.header-actions {
  display: flex;
  gap: 10px;
}

.icon-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: all 0.2s;
}

.icon-btn:hover {
  background: var(--hover-bg);
  color: var(--text-primary);
}

.search-container {
  padding: 15px 20px;
  border-bottom: 1px solid var(--border-color);
}

.search-box {
  position: relative;
}

.search-box input {
  width: 100%;
  padding: 10px 15px 10px 40px;
  background: var(--primary-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.search-box input:focus {
  border-color: var(--accent-color);
}

.search-box::before {
  content: "üîç";
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
}

.chats-list {
  flex: 1;
  overflow-y: auto;
}

.chat-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-color);
  transition: background 0.2s;
}

.chat-item:hover,
.chat-item.active {
  background: var(--hover-bg);
}

.chat-item.unread {
  background: rgba(59, 130, 246, 0.1);
}

.chat-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  margin-right: 12px;
  position: relative;
}

.online-dot {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 12px;
  height: 12px;
  background: var(--online-color);
  border: 2px solid var(--secondary-bg);
  border-radius: 50%;
}

.chat-info {
  flex: 1;
  min-width: 0;
}

.chat-name {
  font-weight: 500;
  margin-bottom: 4px;
  display: flex;
  justify-content: space-between;
}

.last-message {
  font-size: 14px;
  color: var(--text-secondary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-time {
  font-size: 12px;
  color: var(--text-secondary);
}

.unread-count {
  background: var(--unread-color);
  color: white;
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 10px;
  margin-left: 8px;
}

/* MAIN CHAT */
.main-chat {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--primary-bg);
}

.chat-header {
  padding: 15px 20px;
  background: var(--secondary-bg);
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.chat-header-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chat-header-title {
  font-weight: 500;
  font-size: 16px;
}

.chat-header-status {
  font-size: 13px;
  color: var(--text-secondary);
}

.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.message-date {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.date-label {
  background: var(--secondary-bg);
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  color: var(--text-secondary);
  display: inline-block;
}

.message-group {
  display: flex;
  flex-direction: column;
  gap: 2px;
  margin-bottom: 10px;
  max-width: 65%;
}

.message-group.me {
  align-self: flex-end;
}

.message-wrapper {
  display: flex;
  gap: 8px;
  align-items: flex-start;
}

.message-wrapper.me {
  flex-direction: row-reverse;
}

.message {
  background: var(--message-bg);
  padding: 8px 12px;
  border-radius: 12px;
  position: relative;
  max-width: 480px;
  word-wrap: break-word;
}

.message.me {
  background: var(--my-message-bg);
  border-bottom-right-radius: 4px;
}

.message:not(.me) {
  border-bottom-left-radius: 4px;
}

.message.selected {
  background: rgba(59, 130, 246, 0.3);
}

.message-text {
  font-size: 15px;
  line-height: 1.4;
}

.message-time {
  font-size: 11px;
  color: var(--text-secondary);
  float: right;
  margin-left: 8px;
  margin-top: 2px;
}

.message-status {
  font-size: 11px;
  margin-left: 4px;
}

.message-actions {
  position: absolute;
  top: -30px;
  right: 0;
  background: var(--secondary-bg);
  border-radius: 8px;
  box-shadow: var(--shadow);
  display: flex;
  gap: 4px;
  padding: 4px;
  z-index: 10;
  opacity: 0;
  transition: opacity 0.2s;
}

.message:hover .message-actions {
  opacity: 1;
}

.action-btn {
  width: 28px;
  height: 28px;
  border-radius: 6px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.action-btn:hover {
  background: var(--hover-bg);
  color: var(--text-primary);
}

.action-btn.edit:hover { color: var(--accent-color); }
.action-btn.delete:hover { color: var(--danger); }
.action-btn.reply:hover { color: var(--success); }

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--accent-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  margin-top: 4px;
  opacity: 0;
  transition: opacity 0.2s;
}

.message-group:hover .message-avatar {
  opacity: 0.7;
}

.reply-preview {
  background: rgba(255, 255, 255, 0.1);
  border-left: 3px solid var(--accent-color);
  padding: 6px 10px;
  margin-bottom: 8px;
  border-radius: 4px;
  font-size: 13px;
  color: var(--text-secondary);
}

.reply-author {
  color: var(--accent-color);
  font-weight: 500;
  margin-bottom: 2px;
}

/* INPUT AREA */
.input-area {
  padding: 15px 20px;
  background: var(--secondary-bg);
  border-top: 1px solid var(--border-color);
}

.reply-container {
  background: var(--hover-bg);
  padding: 8px 12px;
  border-radius: 8px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: slideIn 0.2s;
}

.reply-info {
  flex: 1;
}

.reply-label {
  font-size: 12px;
  color: var(--accent-color);
  margin-bottom: 2px;
}

.reply-text {
  font-size: 14px;
  color: var(--text-primary);
}

.input-wrapper {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.input-actions {
  display: flex;
  gap: 5px;
}

.message-input {
  flex: 1;
  min-height: 40px;
  max-height: 120px;
  padding: 10px 15px;
  background: var(--primary-bg);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  color: var(--text-primary);
  font-size: 15px;
  line-height: 1.4;
  resize: none;
  outline: none;
  overflow-y: auto;
}

.message-input:focus {
  border-color: var(--accent-color);
}

.send-button {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--accent-color);
  border: none;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.send-button:hover {
  background: #2563eb;
  transform: scale(1.05);
}

.send-button:disabled {
  background: var(--text-secondary);
  cursor: not-allowed;
  transform: none;
}

.edit-mode {
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid var(--accent-color);
}

/* CONTEXT MENU */
.context-menu {
  position: fixed;
  background: var(--secondary-bg);
  border-radius: 8px;
  box-shadow: var(--shadow);
  min-width: 160px;
  z-index: 1000;
  overflow: hidden;
  animation: fadeIn 0.2s;
}

.context-item {
  padding: 12px 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.2s;
  color: var(--text-primary);
  text-decoration: none;
}

.context-item:hover {
  background: var(--hover-bg);
}

.context-item.danger {
  color: var(--danger);
}

.context-item.danger:hover {
  background: rgba(239, 68, 68, 0.1);
}

/* MODAL */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal {
  background: var(--secondary-bg);
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  box-shadow: var(--shadow);
  animation: modalIn 0.3s;
}

.modal-header {
  padding: 20px;
  border-bottom: 1px solid var(--border-color);
}

.modal-title {
  font-size: 18px;
  font-weight: 500;
}

.modal-body {
  padding: 20px;
}

.modal-actions {
  padding: 20px;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.btn {
  padding: 10px 20px;
  border-radius: 8px;
  border: none;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.btn.primary {
  background: var(--accent-color);
  color: white;
}

.btn.primary:hover {
  background: #2563eb;
}

.btn.secondary {
  background: var(--hover-bg);
  color: var(--text-primary);
}

.btn.secondary:hover {
  background: var(--border-color);
}

.btn.danger {
  background: var(--danger);
  color: white;
}

.btn.danger:hover {
  background: #dc2626;
}

/* ANIMATIONS */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes modalIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .sidebar {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    z-index: 100;
    transform: translateX(-100%);
  }
  
  .sidebar.active {
    transform: translateX(0);
  }
  
  .message-group {
    max-width: 85%;
  }
}

/* LOADING */
.typing-indicator {
  display: flex;
  gap: 4px;
  padding: 10px 15px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--text-secondary);
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-6px); }
}

/* SCROLLBAR */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-secondary);
}

/* UTILITIES */
.text-muted {
  color: var(--text-secondary) !important;
}

.text-small {
  font-size: 12px !important;
}

.text-center {
  text-align: center !important;
}

.mt-2 { margin-top: 8px !important; }
.mb-2 { margin-bottom: 8px !important; }
.ml-2 { margin-left: 8px !important; }
.mr-2 { margin-right: 8px !important; }

.d-flex { display: flex !important; }
.align-center { align-items: center !important; }
.justify-between { justify-content: space-between !important; }
.flex-1 { flex: 1 !important; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>
<div class="container">
  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="user-info" onclick="openMyProfile()">
        <div class="user-avatar" id="sidebarAvatar">üë§</div>
        <div>
          <div id="sidebarUsername">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
          <div class="text-muted text-small">–æ–Ω–ª–∞–π–Ω</div>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" onclick="toggleSearch()">üîç</button>
        <button class="icon-btn" onclick="openMyProfile()">üë§</button>
        <button class="icon-btn" onclick="logout()">üö™</button>
      </div>
    </div>
    
    <div class="search-container hidden" id="searchContainer">
      <div class="search-box">
        <input type="text" 
               placeholder="–ü–æ–∏—Å–∫ –≤ —á–∞—Ç–∞—Ö..." 
               id="chatSearch"
               oninput="searchChats(this.value)">
      </div>
    </div>
    
    <div class="chats-list" id="chatsList">
      <!-- Chats will be loaded here -->
    </div>
  </div>
  
  <!-- MAIN CHAT -->
  <div class="main-chat" id="mainChat">
    <div class="chat-header">
      <div class="chat-header-info">
        <button class="icon-btn mobile-only" onclick="toggleSidebar()">‚ò∞</button>
        <div class="chat-avatar" id="currentChatAvatar">
          <div id="chatAvatarText">üë•</div>
          <div class="online-dot hidden" id="chatOnlineDot"></div>
        </div>
        <div>
          <div class="chat-header-title" id="currentChatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
          <div class="chat-header-status" id="currentChatStatus">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</div>
        </div>
      </div>
      <div class="header-actions">
        <button class="icon-btn" onclick="searchInChat()">üîç</button>
        <button class="icon-btn" onclick="showChatInfo()">‚ìò</button>
      </div>
    </div>
    
    <div class="messages-container" id="messagesContainer">
      <div class="text-center text-muted mt-2" id="noMessages">
        –°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!
      </div>
    </div>
    
    <div class="input-area">
      <div class="reply-container hidden" id="replyContainer">
        <div class="reply-info">
          <div class="reply-label" id="replyLabel">–û—Ç–≤–µ—Ç–∏—Ç—å</div>
          <div class="reply-text" id="replyText"></div>
        </div>
        <button class="icon-btn" onclick="cancelReply()">‚úï</button>
      </div>
      
      <div class="edit-container hidden" id="editContainer">
        <div class="reply-info">
          <div class="reply-label">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
          <div class="reply-text" id="editText"></div>
        </div>
        <button class="icon-btn" onclick="cancelEdit()">‚úï</button>
      </div>
      
      <div class="input-wrapper">
        <div class="input-actions">
          <button class="icon-btn" onclick="toggleEmoji()">üòÄ</button>
          <button class="icon-btn" onclick="attachFile()">üìé</button>
        </div>
        
        <textarea class="message-input" 
                  id="messageInput"
                  placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                  rows="1"
                  onkeydown="handleInputKeydown(event)"
                  oninput="autoResize(this)"></textarea>
        
        <button class="send-button" onclick="sendMessage()" id="sendButton">
          ‚û§
        </button>
      </div>
    </div>
  </div>
  
  <!-- EMOJI PANEL -->
  <div class="emoji-panel hidden" id="emojiPanel">
    <div class="emoji-category">
      <button class="emoji-cat-btn active" onclick="setEmojiCategory('faces')">üòÄ</button>
      <button class="emoji-cat-btn" onclick="setEmojiCategory('hands')">üëã</button>
      <button class="emoji-cat-btn" onclick="setEmojiCategory('hearts')">‚ù§Ô∏è</button>
      <button class="emoji-cat-btn" onclick="setEmojiCategory('animals')">üê∂</button>
      <button class="emoji-cat-btn" onclick="setEmojiCategory('objects')">üí°</button>
    </div>
    <div class="emoji-grid" id="emojiGrid"></div>
  </div>
</div>

<!-- CONTEXT MENUS -->
<div class="context-menu hidden" id="messageContextMenu"></div>
<div class="context-menu hidden" id="chatContextMenu"></div>

<!-- MODALS -->
<div class="modal-overlay hidden" id="deleteModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
    </div>
    <div class="modal-body">
      –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('deleteModal')">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn danger" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="modal-overlay hidden" id="searchModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">–ü–æ–∏—Å–∫ –≤ —á–∞—Ç–µ</div>
    </div>
    <div class="modal-body">
      <input type="text" 
             class="message-input" 
             placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞..."
             id="searchChatInput"
             oninput="performChatSearch(this.value)">
      <div class="search-results mt-2" id="searchResults"></div>
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('searchModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<!-- AUTH SCREEN -->
<div class="modal-overlay" id="authModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram Web</div>
    </div>
    <div class="modal-body">
      <input type="email" 
             class="message-input mb-2" 
             placeholder="Email"
             id="authEmail">
      <input type="password" 
             class="message-input" 
             placeholder="–ü–∞—Ä–æ–ª—å"
             id="authPassword">
    </div>
    <div class="modal-actions">
      <button class="btn primary" onclick="handleAuth()">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>
  </div>
</div>

<!-- PROFILE MODAL -->
<div class="modal-overlay hidden" id="profileModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
    </div>
    <div class="modal-body">
      <div class="text-center mb-2">
        <div class="user-avatar large" style="width:80px;height:80px;font-size:32px;margin:0 auto 15px;" id="profileAvatar">üë§</div>
        <input type="text" 
               class="message-input mb-2" 
               placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
               id="profileUsername">
        <textarea class="message-input" 
                  placeholder="–û —Å–µ–±–µ"
                  id="profileBio"
                  rows="3"></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn secondary" onclick="closeModal('profileModal')">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn primary" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
// Firebase Configuration
firebase.initializeApp({
  apiKey: "AIzaSyDioAafJRuJ4eMGK25-RsQb8M95CWlb1BY",
  authDomain: "chatnet-2a748.firebaseapp.com",
  projectId: "chatnet-2a748"
});

const auth = firebase.auth();
const db = firebase.firestore();

// App State
let currentUser = null;
let currentChat = null;
let currentChatId = null;
let messagesUnsubscribe = null;
let chatsUnsubscribe = null;
let editingMessageId = null;
let replyingToMessageId = null;
let selectedMessageId = null;
let searchTerm = '';

// Emoji Data
const emojiCategories = {
  'faces': ['üòÄ','üòÇ','üòä','üòç','üòé','üòú','üò¢','üò°','ü•≥','üò¥','ü§î','ü§©','ü•∫','üòá','ü§Ø','üò±','ü§†','üòà','üëª','ü§ñ'],
  'hands': ['üëã','ü§ö','üñêÔ∏è','‚úã','üññ','üëå','ü§è','‚úåÔ∏è','ü§û','ü§ü','ü§ò','ü§ô','üëà','üëâ','üëÜ','üñï','üëá','‚òùÔ∏è','üëç','üëé'],
  'hearts': ['‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','üñ§','ü§ç','ü§é','üíî','‚ù§Ô∏è‚Äçüî•','‚ù§Ô∏è‚Äçü©π','üíï','üíû','üíì','üíó','üíñ','üíò','üíù','üíü'],
  'animals': ['üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº','üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üêî','üêß','üê¶','ü¶Ü','ü¶Ö'],
  'objects': ['üí°','üì±','üíª','‚åö','üì∑','üéÆ','üîë','üí∞','üíé','‚úèÔ∏è','üìö','üéµ','üé¨','‚öΩ','üèÄ','üéÅ','üéà','üéÄ','üõí','üì¶']
};

// Initialize
function init() {
  initEmojiPanel();
  setupEventListeners();
  
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      currentUser = user;
      const userDoc = await db.collection('users').doc(user.uid).get();
      if (userDoc.exists) {
        startApp(userDoc.data());
      } else {
        showModal('profileModal');
      }
    } else {
      showModal('authModal');
    }
  });
}

// Authentication
async function handleAuth() {
  const email = document.getElementById('authEmail').value;
  const password = document.getElementById('authPassword').value;
  
  if (!email || !password) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return;
  }
  
  try {
    await auth.createUserWithEmailAndPassword(email, password);
  } catch (error) {
    if (error.code === 'auth/email-already-in-use') {
      await auth.signInWithEmailAndPassword(email, password);
    } else {
      alert('–û—à–∏–±–∫–∞: ' + error.message);
    }
  }
}

async function saveProfile() {
  const username = document.getElementById('profileUsername').value;
  const bio = document.getElementById('profileBio').value;
  
  if (!username) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    return;
  }
  
  await db.collection('users').doc(currentUser.uid).set({
    username,
    bio: bio || '',
    avatar: 'üë§',
    online: true,
    lastSeen: Date.now(),
    createdAt: Date.now()
  }, { merge: true });
  
  closeModal('profileModal');
  startApp({ username, bio, avatar: 'üë§' });
}

function startApp(userData) {
  document.getElementById('sidebarUsername').textContent = userData.username;
  document.getElementById('sidebarAvatar').textContent = userData.avatar || 'üë§';
  
  loadChats();
  updateOnlineStatus();
}

// Chats Management
async function loadChats() {
  chatsUnsubscribe = db.collection('users').onSnapshot(async (snapshot) => {
    const chatsList = document.getElementById('chatsList');
    chatsList.innerHTML = '';
    
    const users = [];
    snapshot.forEach(doc => {
      if (doc.id !== currentUser.uid) {
        users.push({ id: doc.id, ...doc.data() });
      }
    });
    
    // For each user, get last message
    for (const user of users) {
      const chatId = [currentUser.uid, user.id].sort().join('_');
      const lastMessage = await getLastMessage(chatId);
      const unreadCount = await getUnreadCount(chatId);
      
      const chatItem = document.createElement('div');
      chatItem.className = `chat-item ${unreadCount > 0 ? 'unread' : ''} ${chatId === currentChatId ? 'active' : ''}`;
      chatItem.innerHTML = `
        <div class="chat-avatar">
          <div>${user.avatar || 'üë§'}</div>
          ${user.online ? '<div class="online-dot"></div>' : ''}
        </div>
        <div class="chat-info">
          <div class="chat-name">
            <span>${user.username}</span>
            <span class="chat-time">${lastMessage ? formatTime(lastMessage.time) : ''}</span>
          </div>
          <div class="last-message">
            ${lastMessage ? (lastMessage.text.length > 30 ? lastMessage.text.substring(0, 30) + '...' : lastMessage.text) : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}
            ${unreadCount > 0 ? `<span class="unread-count">${unreadCount}</span>` : ''}
          </div>
        </div>
      `;
      
      chatItem.onclick = () => openChat(user.id, user);
      chatItem.oncontextmenu = (e) => {
        e.preventDefault();
        showChatContextMenu(e, user.id);
      };
      
      chatsList.appendChild(chatItem);
    }
  });
}

async function getLastMessage(chatId) {
  const snapshot = await db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .orderBy('time', 'desc')
    .limit(1)
    .get();
  
  return snapshot.empty ? null : snapshot.docs[0].data();
}

async function getUnreadCount(chatId) {
  const snapshot = await db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .where('uid', '!=', currentUser.uid)
    .where('read', '==', false)
    .get();
  
  return snapshot.size;
}

// Chat Functions
async function openChat(userId, userData) {
  currentChat = userData;
  currentChatId = [currentUser.uid, userId].sort().join('_');
  
  // Update UI
  document.getElementById('currentChatName').textContent = userData.username;
  document.getElementById('currentChatStatus').textContent = userData.online ? 'online' : '–±—ã–ª(–∞) ' + formatLastSeen(userData.lastSeen);
  document.getElementById('chatAvatarText').textContent = userData.avatar || 'üë§';
  document.getElementById('chatOnlineDot').classList.toggle('hidden', !userData.online);
  
  // Mark all as read
  await markAsRead(currentChatId);
  
  // Load messages
  loadMessages(currentChatId);
  
  // Update active chat in sidebar
  document.querySelectorAll('.chat-item').forEach(item => {
    item.classList.remove('active');
  });
  document.querySelector(`.chat-item[data-chat-id="${currentChatId}"]`)?.classList.add('active');
  
  // Close sidebar on mobile
  if (window.innerWidth < 768) {
    document.getElementById('sidebar').classList.remove('active');
  }
}

async function loadMessages(chatId) {
  if (messagesUnsubscribe) {
    messagesUnsubscribe();
  }
  
  messagesUnsubscribe = db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .orderBy('time', 'asc')
    .onSnapshot((snapshot) => {
      const messagesContainer = document.getElementById('messagesContainer');
      messagesContainer.innerHTML = '';
      
      let lastDate = null;
      let lastSender = null;
      
      snapshot.forEach((doc) => {
        const message = doc.data();
        const messageDate = new Date(message.time).toDateString();
        
        // Add date separator
        if (messageDate !== lastDate) {
          lastDate = messageDate;
          const dateElement = document.createElement('div');
          dateElement.className = 'message-date';
          dateElement.innerHTML = `<div class="date-label">${formatDate(message.time)}</div>`;
          messagesContainer.appendChild(dateElement);
        }
        
        // Check if new message group
        const isNewGroup = lastSender !== message.uid;
        lastSender = message.uid;
        
        const isMe = message.uid === currentUser.uid;
        
        const messageElement = document.createElement('div');
        messageElement.className = `message-group ${isMe ? 'me' : ''}`;
        messageElement.dataset.messageId = doc.id;
        
        if (message.replyTo) {
          messageElement.innerHTML += `
            <div class="reply-preview">
              <div class="reply-author">${isMe ? '–í—ã' : currentChat.username}</div>
              <div>${message.replyTo.text}</div>
            </div>
          `;
        }
        
        messageElement.innerHTML += `
          <div class="message-wrapper ${isMe ? 'me' : ''}">
            <div class="message-avatar">${isMe ? (currentUser.displayName?.charAt(0) || '–Ø') : (currentChat?.username?.charAt(0) || '–î')}</div>
            <div class="message ${isMe ? 'me' : ''} ${selectedMessageId === doc.id ? 'selected' : ''}">
              <div class="message-text">${message.text}</div>
              <div class="message-time">
                ${formatTime(message.time)}
                ${isMe ? `<span class="message-status">${getMessageStatus(message)}</span>` : ''}
              </div>
              <div class="message-actions">
                <button class="action-btn reply" onclick="replyToMessage('${doc.id}', '${message.text}')">‚Ü©</button>
                ${isMe ? `
                  <button class="action-btn edit" onclick="editMessage('${doc.id}', '${message.text}')">‚úèÔ∏è</button>
                  <button class="action-btn delete" onclick="showDeleteModal('${doc.id}')">üóëÔ∏è</button>
                ` : ''}
              </div>
            </div>
          </div>
        `;
        
        messagesContainer.appendChild(messageElement);
        
        // Add context menu
        messageElement.querySelector('.message').oncontextmenu = (e) => {
          e.preventDefault();
          showMessageContextMenu(e, doc.id, message);
        };
      });
      
      // Scroll to bottom
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Show/hide no messages text
      document.getElementById('noMessages').classList.toggle('hidden', snapshot.size > 0);
    });
}

// Message Functions
async function sendMessage() {
  const input = document.getElementById('messageInput');
  const text = input.value.trim();
  
  if (!text || !currentChatId) return;
  
  const messageData = {
    uid: currentUser.uid,
    text,
    time: Date.now(),
    read: false,
    edited: false
  };
  
  if (replyingToMessageId) {
    messageData.replyTo = {
      messageId: replyingToMessageId,
      text: document.getElementById('replyText').textContent
    };
  }
  
  if (editingMessageId) {
    // Update existing message
    await db.collection('chats')
      .doc(currentChatId)
      .collection('messages')
      .doc(editingMessageId)
      .update({
        text,
        edited: true,
        editTime: Date.now()
      });
    
    cancelEdit();
  } else {
    // Add new message
    await db.collection('chats')
      .doc(currentChatId)
      .collection('messages')
      .add(messageData);
    
    cancelReply();
  }
  
  input.value = '';
  autoResize(input);
}

async function editMessage(messageId, currentText) {
  editingMessageId = messageId;
  document.getElementById('editContainer').classList.remove('hidden');
  document.getElementById('editText').textContent = currentText;
  document.getElementById('messageInput').value = currentText;
  document.getElementById('messageInput').focus();
  document.getElementById('messageInput').classList.add('edit-mode');
}

function cancelEdit() {
  editingMessageId = null;
  document.getElementById('editContainer').classList.add('hidden');
  document.getElementById('messageInput').classList.remove('edit-mode');
}

function replyToMessage(messageId, text) {
  replyingToMessageId = messageId;
  document.getElementById('replyContainer').classList.remove('hidden');
  document.getElementById('replyText').textContent = text;
  document.getElementById('messageInput').focus();
}

function cancelReply() {
  replyingToMessageId = null;
  document.getElementById('replyContainer').classList.add('hidden');
}

async function markAsRead(chatId) {
  const snapshot = await db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .where('uid', '!=', currentUser.uid)
    .where('read', '==', false)
    .get();
  
  const batch = db.batch();
  snapshot.forEach(doc => {
    batch.update(doc.ref, { read: true });
  });
  
  if (!snapshot.empty) {
    await batch.commit();
  }
}

// Message Actions
function showDeleteModal(messageId) {
  selectedMessageId = messageId;
  showModal('deleteModal');
}

async function confirmDelete() {
  if (!selectedMessageId || !currentChatId) return;
  
  await db.collection('chats')
    .doc(currentChatId)
    .collection('messages')
    .doc(selectedMessageId)
    .delete();
  
  closeModal('deleteModal');
  selectedMessageId = null;
}

// Search Functions
function searchInChat() {
  showModal('searchModal');
}

async function performChatSearch(query) {
  if (!query || !currentChatId) return;
  
  const snapshot = await db.collection('chats')
    .doc(currentChatId)
    .collection('messages')
    .orderBy('time', 'asc')
    .get();
  
  const results = snapshot.docs.filter(doc => 
    doc.data().text.toLowerCase().includes(query.toLowerCase())
  );
  
  const resultsContainer = document.getElementById('searchResults');
  resultsContainer.innerHTML = '';
  
  if (results.length === 0) {
    resultsContainer.innerHTML = '<div class="text-muted text-center">–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
    return;
  }
  
  results.forEach(doc => {
    const message = doc.data();
    const resultElement = document.createElement('div');
    resultElement.className = 'search-result-item';
    resultElement.innerHTML = `
      <div class="text-small text-muted">${formatTime(message.time)}</div>
      <div>${message.text}</div>
    `;
    resultElement.onclick = () => scrollToMessage(doc.id);
    resultsContainer.appendChild(resultElement);
  });
}

function scrollToMessage(messageId) {
  const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
  if (messageElement) {
    messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    messageElement.classList.add('selected');
    setTimeout(() => messageElement.classList.remove('selected'), 2000);
  }
  closeModal('searchModal');
}

function searchChats(query) {
  searchTerm = query.toLowerCase();
  document.querySelectorAll('.chat-item').forEach(item => {
    const name = item.querySelector('.chat-name span').textContent.toLowerCase();
    item.style.display = name.includes(searchTerm) ? 'flex' : 'none';
  });
}

// UI Functions
function autoResize(textarea) {
  textarea.style.height = 'auto';
  textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
}

function handleInputKeydown(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('active');
}

function toggleSearch() {
  document.getElementById('searchContainer').classList.toggle('hidden');
  document.getElementById('chatSearch').focus();
}

function initEmojiPanel() {
  const grid = document.getElementById('emojiGrid');
  setEmojiCategory('faces');
}

function setEmojiCategory(category) {
  const grid = document.getElementById('emojiGrid');
  grid.innerHTML = '';
  
  document.querySelectorAll('.emoji-cat-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  emojiCategories[category].forEach(emoji => {
    const span = document.createElement('span');
    span.textContent = emoji;
    span.className = 'emoji-item';
    span.onclick = () => {
      document.getElementById('messageInput').value += emoji;
      document.getElementById('messageInput').focus();
    };
    grid.appendChild(span);
  });
}

function toggleEmoji() {
  // Implement emoji panel toggle
  alert('–≠–º–æ–¥–∑–∏ –ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
}

function attachFile() {
  alert('–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
}

// Context Menus
function showMessageContextMenu(e, messageId, message) {
  const menu = document.getElementById('messageContextMenu');
  menu.innerHTML = '';
  
  const isMe = message.uid === currentUser.uid;
  
  if (!isMe) {
    menu.innerHTML += `
      <div class="context-item" onclick="replyToMessage('${messageId}', '${message.text}')">
        <span>‚Ü©</span> –û—Ç–≤–µ—Ç–∏—Ç—å
      </div>
    `;
  }
  
  if (isMe) {
    menu.innerHTML += `
      <div class="context-item" onclick="editMessage('${messageId}', '${message.text}')">
        <span>‚úèÔ∏è</span> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
      </div>
      <div class="context-item danger" onclick="showDeleteModal('${messageId}')">
        <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å
      </div>
    `;
  }
  
  menu.innerHTML += `
    <div class="context-item" onclick="navigator.clipboard.writeText('${message.text}')">
      <span>üìã</span> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
    </div>
  `;
  
  menu.style.left = e.pageX + 'px';
  menu.style.top = e.pageY + 'px';
  menu.classList.remove('hidden');
  
  // Close menu on click outside
  setTimeout(() => {
    document.addEventListener('click', closeContextMenus);
  }, 100);
}

function showChatContextMenu(e, userId) {
  e.preventDefault();
  const menu = document.getElementById('chatContextMenu');
  menu.innerHTML = `
    <div class="context-item" onclick="openChat('${userId}')">
      <span>üí¨</span> –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç
    </div>
    <div class="context-item" onclick="clearChatHistory('${userId}')">
      <span>üßπ</span> –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
    </div>
    <div class="context-item danger" onclick="deleteChat('${userId}')">
      <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å —á–∞—Ç
    </div>
  `;
  
  menu.style.left = e.pageX + 'px';
  menu.style.top = e.pageY + 'px';
  menu.classList.remove('hidden');
  
  setTimeout(() => {
    document.addEventListener('click', closeContextMenus);
  }, 100);
}

function closeContextMenus() {
  document.getElementById('messageContextMenu').classList.add('hidden');
  document.getElementById('chatContextMenu').classList.add('hidden');
  document.removeEventListener('click', closeContextMenus);
}

async function clearChatHistory(userId) {
  if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏?')) return;
  
  const chatId = [currentUser.uid, userId].sort().join('_');
  const snapshot = await db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .get();
  
  const batch = db.batch();
  snapshot.forEach(doc => {
    batch.delete(doc.ref);
  });
  
  await batch.commit();
  closeContextMenus();
}

async function deleteChat(userId) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —á–∞—Ç –∏ –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏?')) return;
  
  const chatId = [currentUser.uid, userId].sort().join('_');
  await db.collection('chats').doc(chatId).delete();
  
  // Also delete all messages
  const messagesSnapshot = await db.collection('chats')
    .doc(chatId)
    .collection('messages')
    .get();
  
  const batch = db.batch();
  messagesSnapshot.forEach(doc => {
    batch.delete(doc.ref);
  });
  
  await batch.commit();
  closeContextMenus();
  
  if (currentChatId === chatId) {
    currentChat = null;
    currentChatId = null;
    document.getElementById('currentChatName').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç';
    document.getElementById('currentChatStatus').textContent = '–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ';
    document.getElementById('messagesContainer').innerHTML = '<div class="text-center text-muted mt-2">–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</div>';
  }
}

// Modals
function showModal(modalId) {
  document.getElementById(modalId).classList.remove('hidden');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.add('hidden');
}

function openMyProfile() {
  db.collection('users').doc(currentUser.uid).get().then(doc => {
    const user = doc.data();
    document.getElementById('profileUsername').value = user.username;
    document.getElementById('profileBio').value = user.bio || '';
    document.getElementById('profileAvatar').textContent = user.avatar || 'üë§';
    showModal('profileModal');
  });
}

function showChatInfo() {
  if (!currentChat) return;
  alert(`–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ:\n\n–ò–º—è: ${currentChat.username}\n–°—Ç–∞—Ç—É—Å: ${currentChat.online ? 'online' : 'offline'}\nID: ${currentChat.id}`);
}

// Utility Functions
function formatTime(timestamp) {
  const date = new Date(timestamp);
  return date.toLocaleTimeString('ru-RU', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });
}

function formatDate(timestamp) {
  const date = new Date(timestamp);
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);
  
  if (date.toDateString() === today.toDateString()) {
    return '–°–µ–≥–æ–¥–Ω—è';
  } else if (date.toDateString() === yesterday.toDateString()) {
    return '–í—á–µ—Ä–∞';
  } else {
    return date.toLocaleDateString('ru-RU', {
      day: 'numeric',
      month: 'long'
    });
  }
}

function formatLastSeen(timestamp) {
  if (!timestamp) return '–¥–∞–≤–Ω–æ';
  const now = Date.now();
  const diff = now - timestamp;
  
  if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
  if (diff < 3600000) return `${Math.floor(diff/60000)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
  if (diff < 86400000) return `${Math.floor(diff/3600000)} —á –Ω–∞–∑–∞–¥`;
  
  return new Date(timestamp).toLocaleDateString('ru-RU');
}

function getMessageStatus(message) {
  if (message.read) return 'üëÅÔ∏è';
  if (message.delivered) return '‚úì‚úì';
  return '‚úì';
}

function updateOnlineStatus() {
  // Update online status every 30 seconds
  setInterval(async () => {
    if (currentUser) {
      await db.collection('users').doc(currentUser.uid).update({
        online: true,
        lastSeen: Date.now()
      });
    }
  }, 30000);
}

function logout() {
  if (currentUser) {
    db.collection('users').doc(currentUser.uid).update({
      online: false,
      lastSeen: Date.now()
    });
  }
  auth.signOut();
  showModal('authModal');
}

// Event Listeners
function setupEventListeners() {
  // Close modals on overlay click
  document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.onclick = (e) => {
      if (e.target === overlay) {
        overlay.classList.add('hidden');
      }
    };
  });
  
  // Close context menus on escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeContextMenus();
    }
  });
}

// Initialize app
init();

// Add CSS for emoji panel
const style = document.createElement('style');
style.textContent = `
.emoji-panel {
  position: absolute;
  bottom: 70px;
  right: 20px;
  background: var(--secondary-bg);
  border-radius: 12px;
  box-shadow: var(--shadow);
  width: 300px;
  padding: 10px;
  z-index: 100;
}

.emoji-category {
  display: flex;
  gap: 5px;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border-color);
}

.emoji-cat-btn {
  flex: 1;
  padding: 5px;
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 20px;
}

.emoji-cat-btn.active {
  background: var(--hover-bg);
}

.emoji-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 5px;
  max-height: 200px;
  overflow-y: auto;
}

.emoji-item {
  font-size: 20px;
  text-align: center;
  cursor: pointer;
  padding: 5px;
  border-radius: 6px;
}

.emoji-item:hover {
  background: var(--hover-bg);
}

.search-result-item {
  padding: 10px;
  border-bottom: 1px solid var(--border-color);
  cursor: pointer;
}

.search-result-item:hover {
  background: var(--hover-bg);
}

.user-avatar.large {
  font-size: 32px;
}

@media (max-width: 768px) {
  .mobile-only {
    display: block !important;
  }
  
  .emoji-panel {
    width: calc(100vw - 40px);
    right: 10px;
    left: 10px;
  }
}
`;
document.head.appendChild(style);
</script>
</body>
</html>
