<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ChatNet</title>

<style>
/* –°–ë–†–û–° –ò –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: #e2e8f0;
  height: 100vh;
  overflow: hidden;
}

.hidden {
  display: none !important;
}

/* –ö–û–ù–¢–ï–ô–ù–ï–† */
.container {
  max-width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #0f172a;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

/* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø - –¢–ï–ú–ù–´–ô –î–ò–ó–ê–ô–ù */
#auth {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  padding: 40px 20px;
  position: relative;
  overflow: hidden;
}

#auth::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
              radial-gradient(circle at 70% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
}

#auth h2 {
  font-size: 3.5rem;
  color: white;
  margin-bottom: 40px;
  font-weight: 800;
  text-align: center;
  letter-spacing: 1px;
  text-shadow: 0 2px 20px rgba(59, 130, 246, 0.3);
  position: relative;
  background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

#auth input {
  width: 100%;
  max-width: 320px;
  padding: 16px 20px;
  margin-bottom: 20px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  background: rgba(30, 41, 59, 0.8);
  backdrop-filter: blur(10px);
  color: white;
  font-size: 16px;
  transition: all 0.3s ease;
}

#auth input::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

#auth input:focus {
  outline: none;
  border-color: #3b82f6;
  background: rgba(30, 41, 59, 0.95);
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
}

#auth button {
  width: 100%;
  max-width: 320px;
  padding: 16px;
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 10px;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

#auth button:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
}

#auth button:active {
  transform: translateY(0);
}

/* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
#main {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: #0f172a;
}

/* –®–ê–ü–ö–ê */
header {
  background: rgba(15, 23, 42, 0.95);
  padding: 16px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 10;
  backdrop-filter: blur(10px);
}

#me {
  font-size: 18px;
  font-weight: 600;
  color: #e2e8f0;
  cursor: pointer;
  padding: 10px 18px;
  border-radius: 12px;
  transition: all 0.3s ease;
  background: rgba(30, 41, 59, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

#me:hover {
  background: rgba(51, 65, 85, 0.8);
  transform: translateY(-1px);
  border-color: rgba(59, 130, 246, 0.3);
}

header button {
  padding: 10px 20px;
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

header button:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
}

/* –í–ö–õ–ê–î–ö–ò */
.tabs {
  display: flex;
  background: rgba(15, 23, 42, 0.95);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  padding: 0 20px;
  backdrop-filter: blur(10px);
}

.tab {
  flex: 1;
  padding: 18px;
  text-align: center;
  cursor: pointer;
  font-weight: 500;
  color: #94a3b8;
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
  font-size: 15px;
  position: relative;
}

.tab:hover {
  color: #e2e8f0;
  background: rgba(30, 41, 59, 0.5);
}

.tab.active {
  color: #60a5fa;
  border-bottom-color: #60a5fa;
  font-weight: 600;
  background: rgba(30, 41, 59, 0.8);
}

.tab.active::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40px;
  height: 40px;
  background: rgba(59, 130, 246, 0.1);
  border-radius: 50%;
  z-index: -1;
}

/* –û–ë–õ–ê–°–¢–¨ –ß–ê–¢–û–í */
#chats {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* –°–ü–ò–°–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô */
#users {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: rgba(15, 23, 42, 0.8);
}

.user {
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  border-radius: 16px;
  margin-bottom: 10px;
  transition: all 0.3s ease;
  background: rgba(30, 41, 59, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.05);
  position: relative;
  overflow: hidden;
}

.user::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 0;
}

.user:hover {
  transform: translateX(5px);
  border-color: rgba(59, 130, 246, 0.3);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.user:hover::before {
  opacity: 1;
}

.avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  flex-shrink: 0;
  position: relative;
  z-index: 1;
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.user-info {
  flex: 1;
  min-width: 0;
  position: relative;
  z-index: 1;
}

.user-info div:first-child {
  font-weight: 600;
  color: #f1f5f9;
  margin-bottom: 4px;
  font-size: 16px;
}

.status {
  font-size: 13px;
  color: #94a3b8;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* –û–ö–ù–û –ß–ê–¢–ê */
.chat {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  background: radial-gradient(circle at 20% 20%, rgba(30, 41, 59, 0.3) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(15, 23, 42, 0.3) 0%, transparent 50%);
  background-color: #0f172a;
}

.msg {
  max-width: 75%;
  padding: 14px 18px;
  margin: 8px 0;
  border-radius: 18px;
  background: rgba(30, 41, 59, 0.8);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  position: relative;
  word-wrap: break-word;
  line-height: 1.5;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  animation: slideIn 0.3s ease;
}

.msg:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border-color: rgba(59, 130, 246, 0.2);
}

.msg.me {
  margin-left: auto;
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  border: none;
  box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
}

.msg.me:hover {
  box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
}

.msg small {
  display: block;
  font-size: 11px;
  opacity: 0.7;
  text-align: right;
  margin-top: 6px;
  font-weight: 400;
}

.reply-preview {
  font-size: 13px;
  color: #cbd5e1;
  border-left: 3px solid #60a5fa;
  padding-left: 10px;
  margin-bottom: 8px;
  background: rgba(96, 165, 250, 0.1);
  padding: 8px 12px;
  border-radius: 10px;
  font-style: italic;
  border-left-width: 4px;
}

/* –ü–ê–ù–ï–õ–¨ –≠–ú–û–î–ó–ò */
#emojiPanel {
  background: rgba(15, 23, 42, 0.95);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding: 20px;
  max-height: 200px;
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.emoji-category {
  display: flex;
  overflow-x: auto;
  gap: 10px;
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.emoji-category-btn {
  background: rgba(30, 41, 59, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #94a3b8;
  padding: 8px 18px;
  border-radius: 20px;
  cursor: pointer;
  white-space: nowrap;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.emoji-category-btn:hover {
  background: rgba(51, 65, 85, 0.8);
  color: #e2e8f0;
}

.emoji-category-btn.active {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  border-color: transparent;
  box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.emoji-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 10px;
  max-height: 120px;
  overflow-y: auto;
  padding: 10px 0;
}

.emoji-grid span {
  font-size: 24px;
  text-align: center;
  cursor: pointer;
  padding: 6px;
  border-radius: 10px;
  transition: all 0.2s ease;
  background: rgba(30, 41, 59, 0.5);
}

.emoji-grid span:hover {
  background: rgba(59, 130, 246, 0.3);
  transform: scale(1.2);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

/* –ü–ê–ù–ï–õ–¨ –í–í–û–î–ê */
.input {
  display: flex;
  gap: 12px;
  padding: 20px;
  background: rgba(15, 23, 42, 0.95);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  align-items: flex-end;
  backdrop-filter: blur(10px);
}

.input input {
  flex: 1;
  padding: 16px 20px;
  border-radius: 25px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  font-size: 16px;
  transition: all 0.3s ease;
  background: rgba(30, 41, 59, 0.8);
  color: #e2e8f0;
}

.input input::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

.input input:focus {
  outline: none;
  border-color: #3b82f6;
  background: rgba(30, 41, 59, 0.95);
  box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
  transform: translateY(-1px);
}

.input button {
  width: 48px;
  height: 48px;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  flex-shrink: 0;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.input button:first-child {
  background: rgba(30, 41, 59, 0.8);
  color: #94a3b8;
  font-size: 20px;
}

.input button:first-child:hover {
  background: rgba(51, 65, 85, 0.8);
  color: #e2e8f0;
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.input button:last-child {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  font-size: 20px;
}

.input button:last-child:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
}

.input button:last-child:active {
  transform: translateY(0);
}

/* –ü–†–ï–í–¨–Æ –û–¢–í–ï–¢–ê */
#replyBox {
  padding: 14px 20px;
  background: rgba(30, 41, 59, 0.9);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  color: #94a3b8;
  backdrop-filter: blur(10px);
}

#replyBox button {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: #94a3b8;
  cursor: pointer;
  font-size: 18px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

#replyBox button:hover {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  transform: rotate(90deg);
}

/* –õ–ï–ù–¢–ê –ù–û–í–û–°–¢–ï–ô */
#news {
  flex: 1;
  overflow-y: auto;
  background: #0f172a;
  padding: 24px;
}

#postText {
  width: 100%;
  padding: 18px 20px;
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  font-size: 16px;
  margin-bottom: 20px;
  background: rgba(30, 41, 59, 0.8);
  resize: none;
  min-height: 120px;
  transition: all 0.3s ease;
  color: #e2e8f0;
}

#postText::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

#postText:focus {
  outline: none;
  border-color: #3b82f6;
  background: rgba(30, 41, 59, 0.95);
  box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
}

#news button {
  padding: 14px 30px;
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

#news button:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
}

.post {
  background: rgba(30, 41, 59, 0.8);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.post:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
  border-color: rgba(59, 130, 246, 0.2);
}

.post b {
  color: #f1f5f9;
  font-size: 16px;
  margin-bottom: 8px;
  display: block;
  font-weight: 600;
}

.post br {
  margin-bottom: 12px;
  display: block;
  content: "";
}

/* –°–ö–†–û–õ–õ–ë–ê–† */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: rgba(30, 41, 59, 0.5);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  border-radius: 10px;
  border: 2px solid rgba(15, 23, 42, 0.8);
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #2563eb, #7c3aed);
}

/* –ê–ù–ò–ú–ê–¶–ò–ò */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.msg {
  animation: slideIn 0.3s ease;
}

.user {
  animation: fadeIn 0.4s ease;
}

/* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
@media (max-width: 768px) {
  .container {
    border-radius: 0;
  }
  
  .tab {
    padding: 16px 12px;
    font-size: 14px;
  }
  
  .avatar {
    width: 44px;
    height: 44px;
    font-size: 22px;
  }
  
  .input {
    padding: 16px;
  }
  
  .input input {
    padding: 14px 18px;
  }
  
  .emoji-grid {
    grid-template-columns: repeat(6, 1fr);
  }
}

@media (max-width: 480px) {
  #auth h2 {
    font-size: 2.5rem;
  }
  
  .tab {
    padding: 14px 8px;
    font-size: 13px;
  }
  
  .emoji-grid {
    grid-template-columns: repeat(5, 1fr);
  }
}

/* –ò–ù–î–ò–ö–ê–¢–û–† –û–ù–õ–ê–ô–ù */
.online-indicator {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 8px;
  position: relative;
}

.online-indicator.online {
  background: #22c55e;
  box-shadow: 0 0 15px #22c55e;
}

.online-indicator.offline {
  background: #64748b;
}

/* –ü–£–õ–¨–°–ò–†–£–Æ–©–ò–ô –ò–ù–î–ò–ö–ê–¢–û–† */
@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
  }
}

.online-indicator.online {
  animation: pulse 2s infinite;
}

/* –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
.action-btn {
  padding: 14px 20px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(30, 41, 59, 0.8);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-weight: 500;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  border-color: rgba(59, 130, 246, 0.3);
}

.action-btn.primary {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
}

.action-btn.success {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
}

.action-btn.danger {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

/* –°–ï–ö–¶–ò–ò */
.profile-section {
  padding: 25px 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 16px;
  color: #60a5fa;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 18px;
  background: #60a5fa;
  border-radius: 2px;
}

/* –ê–í–ê–¢–ê–† –°–ï–õ–ï–ö–¢–û–† */
.avatar-selector {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 12px;
  margin: 20px 0;
}

.avatar-option {
  font-size: 28px;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(30, 41, 59, 0.8);
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.3s ease;
}

.avatar-option:hover {
  transform: scale(1.1);
  border-color: rgba(59, 130, 246, 0.5);
  background: rgba(59, 130, 246, 0.2);
}

.avatar-option.selected {
  border-color: #3b82f6;
  background: rgba(59, 130, 246, 0.3);
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
}

/* –°–¢–ê–¢–£–° –°–ï–õ–ï–ö–¢–û–† */
.status-selector {
  display: flex;
  gap: 12px;
  margin: 20px 0;
}

.status-option {
  flex: 1;
  padding: 14px;
  text-align: center;
  background: rgba(30, 41, 59, 0.8);
  border-radius: 12px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.3s ease;
  font-weight: 500;
}

.status-option:hover {
  background: rgba(51, 65, 85, 0.8);
  transform: translateY(-2px);
}

.status-option.selected {
  border-color: #3b82f6;
  background: rgba(59, 130, 246, 0.2);
  box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>
<div class="container">

<!-- AUTH -->
<div id="auth">
  <h2>ChatNet</h2>
  <input id="email" placeholder="Email"><br><br>
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
  <button onclick="login()">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>

<!-- PROFILE SETUP -->
<div id="profileSetup" class="hidden">
  <div class="profile-header" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 40px 20px 30px; text-align: center;">
    <div class="profile-avatar" id="setupAvatarPreview" style="font-size: 64px; width: 120px; height: 120px; margin: 0 auto 25px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3)); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 4px solid rgba(255, 255, 255, 0.2); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);">üë§</div>
    <div class="profile-name" style="font-size: 28px; font-weight: 700; margin-bottom: 8px; color: #f1f5f9;">–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>
  </div>
  
  <div class="profile-section">
    <div class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</div>
    <div class="avatar-selector" id="avatarSelectorSetup">
      <div class="avatar-option selected" onclick="selectAvatar('üë§', 'setup')">üë§</div>
      <div class="avatar-option" onclick="selectAvatar('üòé', 'setup')">üòé</div>
      <div class="avatar-option" onclick="selectAvatar('ü§ñ', 'setup')">ü§ñ</div>
      <div class="avatar-option" onclick="selectAvatar('üê∂', 'setup')">üê∂</div>
      <div class="avatar-option" onclick="selectAvatar('ü¶ä', 'setup')">ü¶ä</div>
      <div class="avatar-option" onclick="selectAvatar('üëë', 'setup')">üëë</div>
    </div>
    
    <input id="username" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º" style="width:100%;margin:10px 0; padding: 14px; border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.1); background: rgba(30, 41, 59, 0.8); color: white;"><br>
    
    <div class="section-title">–°—Ç–∞—Ç—É—Å</div>
    <div class="status-selector" id="statusSelectorSetup">
      <div class="status-option selected" onclick="selectStatus('online', 'setup')">üü¢ –í —Å–µ—Ç–∏</div>
      <div class="status-option" onclick="selectStatus('busy', 'setup')">üü° –ó–∞–Ω—è—Ç</div>
      <div class="status-option" onclick="selectStatus('invisible', 'setup')">‚ö™ –ù–µ–≤–∏–¥–∏–º–∫–∞</div>
    </div>
    
    <textarea id="bio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..." style="width:100%;height:80px;margin:10px 0; padding: 14px; border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.1); background: rgba(30, 41, 59, 0.8); color: white;"></textarea><br>
    
    <button onclick="saveProfile()" style="width:100%;padding:16px;background:linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 12px; font-weight: 600;">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
  </div>
</div>

<!-- MAIN -->
<div id="main" class="hidden">
<header>
  <span id="me" onclick="openMyProfile()" style="cursor:pointer"></span>
  <button onclick="logout()">–í—ã–π—Ç–∏</button>
</header>

<div id="chats">
  <div class="chat" id="chat"></div>

  <div id="replyBox" class="hidden">
    –û—Ç–≤–µ—Ç: <span id="replyText"></span>
    <button onclick="cancelReply()">‚úñ</button>
  </div>

  <div id="emojiPanel" class="hidden">
    <div class="emoji-category" id="emojiCategories"></div>
    <div class="emoji-grid" id="emojiGrid"></div>
  </div>

  <div class="input">
    <button onclick="toggleEmoji()">üòÄ</button>
    <input id="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
    <button onclick="send()">‚û§</button>
  </div>

  <div style="padding: 20px; font-weight: 600; color: #f1f5f9; background: rgba(15, 23, 42, 0.95); border-bottom: 1px solid rgba(255, 255, 255, 0.1);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
  <div id="users"></div>
</div>

<div id="news" class="hidden">
  <textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea><br><br>
  <button onclick="createPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  <hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 20px 0;">
  <div id="posts"></div>
</div>

<div id="friends" class="hidden" style="padding:24px;overflow:auto;flex:1; background: #0f172a;">
  <div style="font-weight: 600; color: #f1f5f9; margin-bottom: 20px; font-size: 18px;">–î—Ä—É–∑—å—è</div>
  <div id="friendsList"></div>
</div>

<div class="tabs">
  <div class="tab active" onclick="openTab('chats',this)">üí¨ –ß–∞—Ç—ã</div>
  <div class="tab" onclick="openTab('news',this)">üì∞ –ù–æ–≤–æ—Å—Ç–∏</div>
  <div class="tab" onclick="openTab('friends',this)">üë• –î—Ä—É–∑—å—è</div>
</div>

</div>

<!-- –ü–†–û–°–ú–û–¢–† –ü–†–û–§–ò–õ–Ø –î–†–£–ì–û–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
<div id="profileView" class="hidden">
  <div class="profile-header" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 50px 20px 30px; text-align: center; position: relative; color: white;">
    <button class="profile-back-btn" onclick="back()" style="position: absolute; left: 20px; top: 20px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 12px 18px; border-radius: 12px; cursor: pointer; backdrop-filter: blur(10px);">‚Üê –ù–∞–∑–∞–¥</button>
    <div class="profile-avatar" id="pAvatar" style="font-size: 64px; width: 120px; height: 120px; margin: 0 auto 25px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3)); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 4px solid rgba(255, 255, 255, 0.2);">üë§</div>
    <div class="profile-name" id="pName" style="font-size: 28px; font-weight: 700; margin-bottom: 8px; color: #f1f5f9;"></div>
    <div class="profile-status" id="pStatus" style="font-size: 16px; color: #94a3b8; margin-bottom: 25px;"></div>
  </div>
  
  <div class="profile-stats" style="display: flex; justify-content: space-around; padding: 25px; background: rgba(15, 23, 42, 0.8); border-radius: 20px; margin: -30px 20px 25px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.1);">
    <div class="stat-item">
      <div class="stat-value" id="pMessages" style="font-size: 28px; font-weight: 800; background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
      <div class="stat-label" style="font-size: 13px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px;">–°–æ–æ–±—â–µ–Ω–∏–π</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="pFriends" style="font-size: 28px; font-weight: 800; background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
      <div class="stat-label" style="font-size: 13px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px;">–î—Ä—É–∑–µ–π</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="pPosts" style="font-size: 28px; font-weight: 800; background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">0</div>
      <div class="stat-label" style="font-size: 13px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px;">–ü–æ—Å—Ç–æ–≤</div>
    </div>
  </div>
  
  <div class="profile-section">
    <div class="section-title">–û —Å–µ–±–µ</div>
    <div class="profile-bio" id="pBio" style="background: rgba(30, 41, 59, 0.6); padding: 20px; border-radius: 16px; line-height: 1.6; border: 1px solid rgba(255, 255, 255, 0.05);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ</div>
  </div>
  
  <div class="profile-section">
    <div class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
    <div class="profile-info-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px;">
      <div class="info-item" style="background: rgba(30, 41, 59, 0.6); padding: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
        <div class="info-label" style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
        <div class="info-value" id="pJoined" style="font-size: 14px; font-weight: 600; color: #f1f5f9;">-</div>
      </div>
      <div class="info-item" style="background: rgba(30, 41, 59, 0.6); padding: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
        <div class="info-label" style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤ —Å–µ—Ç–∏</div>
        <div class="info-value" id="pLastSeen" style="font-size: 14px; font-weight: 600; color: #f1f5f9;">-</div>
      </div>
      <div class="info-item" style="background: rgba(30, 41, 59, 0.6); padding: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
        <div class="info-label" style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">–°—Ç–∞—Ç—É—Å</div>
        <div class="info-value" id="pOnlineStatus" style="font-size: 14px; font-weight: 600; color: #f1f5f9;">-</div>
      </div>
      <div class="info-item" style="background: rgba(30, 41, 59, 0.6); padding: 16px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.05);">
        <div class="info-label" style="font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">ID</div>
        <div class="info-value" style="font-size: 12px; color: #94a3b8;" id="pId">-</div>
      </div>
    </div>
  </div>
  
  <div class="profile-actions" style="padding: 20px; display: flex; gap: 12px; flex-wrap: wrap;">
    <button class="action-btn primary" onclick="writeFromProfile()" style="flex: 1;">
      ‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å
    </button>
    <button class="action-btn" onclick="toggleFriend()" id="friendBtn" style="flex: 1;">
      ü§ù –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è
    </button>
    <button class="action-btn danger" onclick="blockUser()" id="blockBtn" style="flex: 1;">
      üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
    </button>
  </div>
</div>

<!-- –ú–û–ô –ü–†–û–§–ò–õ–¨ (–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï) -->
<div id="myProfile" class="hidden">
  <div class="profile-header" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 50px 20px 30px; text-align: center; position: relative; color: white;">
    <button class="profile-back-btn" onclick="back()" style="position: absolute; left: 20px; top: 20px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 12px 18px; border-radius: 12px; cursor: pointer; backdrop-filter: blur(10px);">‚Üê –ù–∞–∑–∞–¥</button>
    <div class="profile-avatar" id="myAvatarPreview" style="font-size: 64px; width: 120px; height: 120px; margin: 0 auto 25px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3)); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 4px solid rgba(255, 255, 255, 0.2);">üë§</div>
    <div class="profile-name" style="font-size: 28px; font-weight: 700; margin-bottom: 8px; color: #f1f5f9;">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
    <div class="profile-status" id="myStatusPreview" style="font-size: 16px; color: #94a3b8; margin-bottom: 25px;">üü¢ –í —Å–µ—Ç–∏</div>
  </div>
  
  <div class="profile-section">
    <div class="section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
    <input id="myUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" style="width:100%;margin:10px 0; padding: 14px; border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.1); background: rgba(30, 41, 59, 0.8); color: white;">
    
    <div class="section-title">–ê–≤–∞—Ç–∞—Ä</div>
    <div class="avatar-selector" id="avatarSelector">
      <div class="avatar-option selected" onclick="selectAvatar('üë§', 'my')">üë§</div>
      <div class="avatar-option" onclick="selectAvatar('üòé', 'my')">üòé</div>
      <div class="avatar-option" onclick="selectAvatar('ü§ñ', 'my')">ü§ñ</div>
      <div class="avatar-option" onclick="selectAvatar('üê∂', 'my')">üê∂</div>
      <div class="avatar-option" onclick="selectAvatar('ü¶ä', 'my')">ü¶ä</div>
      <div class="avatar-option" onclick="selectAvatar('üëë', 'my')">üëë</div>
    </div>
    <input id="myAvatarCustom" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π —ç–º–æ–¥–∑–∏" style="width:100%;margin:10px 0; padding: 14px; border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.1); background: rgba(30, 41, 59, 0.8); color: white;">
    
    <div class="section-title">–°—Ç–∞—Ç—É—Å</div>
    <div class="status-selector" id="statusSelector">
      <div class="status-option selected" onclick="selectStatus('online', 'my')">üü¢ –í —Å–µ—Ç–∏</div>
      <div class="status-option" onclick="selectStatus('busy', 'my')">üü° –ó–∞–Ω—è—Ç</div>
      <div class="status-option" onclick="selectStatus('away', 'my')">üü† –û—Ç–æ—à–µ–ª</div>
      <div class="status-option" onclick="selectStatus('invisible', 'my')">‚ö™ –ù–µ–≤–∏–¥–∏–º–∫–∞</div>
    </div>
    
    <div class="section-title">–û —Å–µ–±–µ</div>
    <textarea id="myBio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..." style="width:100%;height:120px; padding: 14px; border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.1); background: rgba(30, 41, 59, 0.8); color: white;"></textarea>
    
    <div class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    <div style="display:flex;align-items:center;gap:12px;margin:15px 0">
      <input type="checkbox" id="showOnline" checked style="width:22px;height:22px;border-radius:6px;border:2px solid rgba(255,255,255,0.2);background:rgba(30,41,59,0.8);appearance:none;position:relative;">
      <label for="showOnline" style="color: #e2e8f0;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å</label>
    </div>
    
    <div style="display:flex;align-items:center;gap:12px;margin:15px 0">
      <input type="checkbox" id="allowMessages" checked style="width:22px;height:22px;border-radius:6px;border:2px solid rgba(255,255,255,0.2);background:rgba(30,41,59,0.8);appearance:none;position:relative;">
      <label for="allowMessages" style="color: #e2e8f0;">–†–∞–∑—Ä–µ—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö</label>
    </div>
    
    <button class="action-btn success" onclick="updateMyProfile()" style="width:100%;margin-top:25px; padding: 16px;">
      üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
    </button>
  </div>
  
  <div class="quick-actions" style="display: flex; gap: 12px; padding: 20px; background: rgba(15, 23, 42, 0.8); border-top: 1px solid rgba(255, 255, 255, 0.1);">
    <div class="quick-action-btn" onclick="showMyStats()" style="flex: 1; text-align: center; padding: 16px; background: rgba(30, 41, 59, 0.8); border-radius: 12px; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease;">
      üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    </div>
    <div class="quick-action-btn" onclick="exportMyData()" style="flex: 1; text-align: center; padding: 16px; background: rgba(30, 41, 59, 0.8); border-radius: 12px; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease;">
      üìÅ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
    </div>
    <div class="quick-action-btn" onclick="deleteAccount()" style="flex: 1; text-align: center; padding: 16px; background: rgba(30, 41, 59, 0.8); border-radius: 12px; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease;">
      üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
    </div>
  </div>
</div>

</div>

<script>
// –í–ê–ñ–ù–û: Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
firebase.initializeApp({
  apiKey: "AIzaSyDioAafJRuJ4eMGK25-RsQb8M95CWlb1BY",
  authDomain: "chatnet-2a748.firebaseapp.com",
  projectId: "chatnet-2a748"
});

const auth = firebase.auth();
const db = firebase.firestore();

let currentChat = null;
let unsub = null;
let replyMsg = null;
let profileUid = null;
let selectedAvatar = 'üë§';
let selectedStatus = 'online';
let selectedAvatarType = 'my';

// –≠–º–æ–¥–∑–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
const emojiCategories = {
  'faces': ['üòÄ','üòÇ','üòä','üòç','üòé','üòú','üò¢','üò°','ü•≥','üò¥','ü§î','ü§©','ü•∫','üòá','ü§Ø','üò±','ü§†','üòà','üëª','ü§ñ'],
  'hands': ['üëã','ü§ö','üñêÔ∏è','‚úã','üññ','üëå','ü§è','‚úåÔ∏è','ü§û','ü§ü','ü§ò','ü§ô','üëà','üëâ','üëÜ','üñï','üëá','‚òùÔ∏è','üëç','üëé'],
  'hearts': ['‚ù§Ô∏è','üß°','üíõ','üíö','üíô','üíú','üñ§','ü§ç','ü§é','üíî','‚ù§Ô∏è‚Äçüî•','‚ù§Ô∏è‚Äçü©π','üíï','üíû','üíì','üíó','üíñ','üíò','üíù','üíü'],
  'animals': ['üê∂','üê±','üê≠','üêπ','üê∞','ü¶ä','üêª','üêº','üê®','üêØ','ü¶Å','üêÆ','üê∑','üê∏','üêµ','üêî','üêß','üê¶','ü¶Ü','ü¶Ö'],
  'food': ['üçé','üçê','üçä','üçã','üçå','üçâ','üçá','üçì','ü´ê','üçà','üçí','üçë','ü•≠','üçç','ü••','ü•ù','üçÖ','ü•ë','ü•¶','ü•ê'],
  'objects': ['üí°','üì±','üíª','‚åö','üì∑','üéÆ','üîë','üí∞','üíé','‚úèÔ∏è','üìö','üéµ','üé¨','‚öΩ','üèÄ','üéÅ','üéà','üéÄ','üõí','üì¶'],
  'symbols': ['‚≠ê','üåü','üåà','‚òÄÔ∏è','‚òÅÔ∏è','‚ùÑÔ∏è','üî•','üíß','üåä','‚ú®','üéØ','‚úÖ','‚ùå','‚û°Ô∏è','‚¨ÖÔ∏è','‚¨ÜÔ∏è','‚¨áÔ∏è','‚ÜóÔ∏è','‚ÜòÔ∏è','üî¥']
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ–¥–∑–∏
function initEmojiPanel() {
  const categoriesContainer = document.getElementById('emojiCategories');
  const emojiGrid = document.getElementById('emojiGrid');
  
  Object.keys(emojiCategories).forEach((cat, index) => {
    const btn = document.createElement('button');
    btn.className = `emoji-category-btn ${index === 0 ? 'active' : ''}`;
    btn.textContent = emojiCategories[cat][0];
    btn.onclick = () => setEmojiCategory(cat);
    categoriesContainer.appendChild(btn);
  });
  
  setEmojiCategory('faces');
}

function setEmojiCategory(category) {
  const emojiGrid = document.getElementById('emojiGrid');
  const buttons = document.querySelectorAll('.emoji-category-btn');
  
  buttons.forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  emojiGrid.innerHTML = '';
  emojiCategories[category].forEach(emoji => {
    const span = document.createElement('span');
    span.textContent = emoji;
    span.onclick = () => addEmoji(emoji);
    emojiGrid.appendChild(span);
  });
}

// –í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞
function selectAvatar(avatar, type) {
  selectedAvatar = avatar;
  selectedAvatarType = type;
  
  const selector = type === 'setup' ? '#avatarSelectorSetup' : '#avatarSelector';
  document.querySelectorAll(`${selector} .avatar-option`).forEach(option => {
    option.classList.remove('selected');
  });
  event.target.classList.add('selected');
  
  if (type === 'setup') {
    document.getElementById('setupAvatarPreview').textContent = avatar;
  } else {
    document.getElementById('myAvatarPreview').textContent = avatar;
    document.getElementById('myAvatarCustom').value = avatar;
  }
}

// –í—ã–±–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
function selectStatus(status, type) {
  selectedStatus = status;
  
  const selector = type === 'setup' ? '#statusSelectorSetup' : '#statusSelector';
  document.querySelectorAll(`${selector} .status-option`).forEach(option => {
    option.classList.remove('selected');
  });
  event.target.classList.add('selected');
  
  if (type === 'my') {
    const statusText = {
      'online': 'üü¢ –í —Å–µ—Ç–∏',
      'busy': 'üü° –ó–∞–Ω—è—Ç',
      'away': 'üü† –û—Ç–æ—à–µ–ª',
      'invisible': '‚ö™ –ù–µ–≤–∏–¥–∏–º–∫–∞'
    };
    document.getElementById('myStatusPreview').textContent = statusText[status];
  }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
function getStatusText(status) {
  const statuses = {
    'online': '–í —Å–µ—Ç–∏',
    'busy': '–ó–∞–Ω—è—Ç',
    'away': '–û—Ç–æ—à–µ–ª',
    'invisible': '–ù–µ –≤ —Å–µ—Ç–∏',
    'offline': '–ù–µ –≤ —Å–µ—Ç–∏'
  };
  return statuses[status] || '–ù–µ –≤ —Å–µ—Ç–∏';
}

/* AUTH */
async function login(){
  try{
    await auth.createUserWithEmailAndPassword(email.value, password.value);
  } catch(err){
    try{
      await auth.signInWithEmailAndPassword(email.value, password.value);
    } catch(err2){
      alert('–û—à–∏–±–∫–∞: ' + err2.message);
    }
  }
}

auth.onAuthStateChanged(async u => {
  if(!u){
    show("auth");
    return;
  }
  
  try {
    await db.collection("users").doc(u.uid).update({
      online: true,
      lastSeen: Date.now(),
      status: 'online'
    });
  } catch(err) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
  }
  
  const d = await db.collection("users").doc(u.uid).get();
  d.exists ? startApp(d.data()) : show("profileSetup");
});

/* PROFILE SETUP */
async function saveProfile(){
  await db.collection("users").doc(auth.currentUser.uid).set({
    username: username.value || `User${Math.floor(Math.random()*10000)}`,
    avatar: selectedAvatar || "üë§",
    bio: bio.value || "",
    online: true,
    lastSeen: Date.now(),
    status: selectedStatus,
    createdAt: Date.now(),
    showOnline: true,
    allowMessages: true,
    friends: [],
    blocked: [],
    stats: {
      messages: 0,
      posts: 0,
      friends: 0
    }
  });
  startApp({username: username.value, avatar: selectedAvatar});
}

/* START */
function startApp(u){
  show("main");
  me.innerText = `${u.avatar || "üë§"} ${u.username}`;
  loadUsers(); 
  loadPosts(); 
  loadFriends();
  initEmojiPanel();
  startLastSeenUpdater();
}

/* TABS */
function openTab(id, el){
  ["chats","news","friends"].forEach(x => document.getElementById(x).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  el.classList.add("active");
}

/* USERS */
const cid = (a,b) => [a,b].sort().join("_");

function formatLastSeen(timestamp) {
  if (!timestamp) return "–¥–∞–≤–Ω–æ";
  const now = Date.now();
  const diff = now - timestamp;
  
  if (diff < 60000) return "—Ç–æ–ª—å–∫–æ —á—Ç–æ";
  if (diff < 3600000) return `${Math.floor(diff/60000)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
  if (diff < 86400000) return `${Math.floor(diff/3600000)} —á –Ω–∞–∑–∞–¥`;
  if (diff < 604800000) return `${Math.floor(diff/86400000)} –¥–Ω –Ω–∞–∑–∞–¥`;
  
  const date = new Date(timestamp);
  return date.toLocaleDateString('ru-RU');
}

function loadUsers(){
  db.collection("users").onSnapshot(s => {
    users.innerHTML = "";
    s.forEach(d => {
      if(d.id !== auth.currentUser.uid){
        const u = d.data();
        let statusText = '';
        
        if (u.status === 'invisible') {
          statusText = '‚ö™ –ù–µ –≤ —Å–µ—Ç–∏';
        } else if (u.online && u.showOnline !== false) {
          statusText = `üü¢ ${getStatusText(u.status || 'online')}`;
        } else {
          statusText = `‚ö™ –±—ã–ª(–∞) ${formatLastSeen(u.lastSeen)}`;
        }
        
        users.innerHTML += `
        <div class="user" onclick="openChat('${d.id}')">
          <div class="avatar" onclick="event.stopPropagation();openProfile('${d.id}')">${u.avatar || "üë§"}</div>
          <div class="user-info">
            <div>${u.username}</div>
            <div class="status">${statusText}</div>
          </div>
        </div>`;
      }
    });
  });
}

/* –ü–†–û–°–ú–û–¢–† –ü–†–û–§–ò–õ–Ø */
async function openProfile(uid){
  profileUid = uid;
  const d = await db.collection("users").doc(uid).get();
  const u = d.data();
  
  if (!u) return;
  
  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  document.getElementById('pAvatar').textContent = u.avatar || "üë§";
  document.getElementById('pName').textContent = u.username || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
  document.getElementById('pBio').textContent = u.bio || "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–±–µ";
  document.getElementById('pId').textContent = uid.substring(0, 8) + '...';
  
  // –°—Ç–∞—Ç—É—Å
  if (u.status === 'invisible') {
    document.getElementById('pStatus').textContent = '‚ö™ –ù–µ –≤ —Å–µ—Ç–∏';
    document.getElementById('pOnlineStatus').textContent = '–ù–µ –≤ —Å–µ—Ç–∏';
  } else if (u.online && u.showOnline !== false) {
    document.getElementById('pStatus').textContent = `üü¢ ${getStatusText(u.status || 'online')}`;
    document.getElementById('pOnlineStatus').textContent = getStatusText(u.status || 'online');
  } else {
    document.getElementById('pStatus').textContent = `‚ö™ –±—ã–ª(–∞) ${formatLastSeen(u.lastSeen)}`;
    document.getElementById('pOnlineStatus').textContent = '–ù–µ –≤ —Å–µ—Ç–∏';
  }
  
  // –í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  if (u.createdAt) {
    const joinDate = new Date(u.createdAt);
    document.getElementById('pJoined').textContent = joinDate.toLocaleDateString('ru-RU');
  } else {
    document.getElementById('pJoined').textContent = '-';
  }
  
  // –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤ —Å–µ—Ç–∏
  document.getElementById('pLastSeen').textContent = formatLastSeen(u.lastSeen);
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  document.getElementById('pMessages').textContent = u.stats?.messages || 0;
  document.getElementById('pFriends').textContent = u.stats?.friends || 0;
  document.getElementById('pPosts').textContent = u.stats?.posts || 0;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –≤ –¥—Ä—É–∑—å—è—Ö
  const myData = await db.collection("users").doc(auth.currentUser.uid).get();
  const myFriends = myData.data()?.friends || [];
  const friendBtn = document.getElementById('friendBtn');
  
  if (myFriends.includes(uid)) {
    friendBtn.innerHTML = 'ü§ù –£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π';
    friendBtn.classList.add('danger');
  } else {
    friendBtn.innerHTML = 'ü§ù –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑–µ–π';
    friendBtn.classList.remove('danger');
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  const myBlocked = myData.data()?.blocked || [];
  const blockBtn = document.getElementById('blockBtn');
  
  if (myBlocked.includes(uid)) {
    blockBtn.innerHTML = '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
    blockBtn.classList.add('success');
  } else {
    blockBtn.innerHTML = 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
    blockBtn.classList.remove('success');
  }
  
  show("profileView");
}

// –î–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π
async function toggleFriend() {
  if (!profileUid) return;
  
  const myRef = db.collection("users").doc(auth.currentUser.uid);
  const myData = await myRef.get();
  const myFriends = myData.data()?.friends || [];
  
  if (myFriends.includes(profileUid)) {
    // –£–¥–∞–ª—è–µ–º –∏–∑ –¥—Ä—É–∑–µ–π
    await myRef.update({
      friends: firebase.firestore.FieldValue.arrayRemove(profileUid),
      'stats.friends': firebase.firestore.FieldValue.increment(-1)
    });
    document.getElementById('friendBtn').innerHTML = 'ü§ù –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑–µ–π';
    document.getElementById('friendBtn').classList.remove('danger');
  } else {
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥—Ä—É–∑–µ–π
    await myRef.update({
      friends: firebase.firestore.FieldValue.arrayUnion(profileUid),
      'stats.friends': firebase.firestore.FieldValue.increment(1)
    });
    document.getElementById('friendBtn').innerHTML = 'ü§ù –£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π';
    document.getElementById('friendBtn').classList.add('danger');
  }
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function blockUser() {
  if (!profileUid) return;
  
  const myRef = db.collection("users").doc(auth.currentUser.uid);
  const myData = await myRef.get();
  const myBlocked = myData.data()?.blocked || [];
  
  if (myBlocked.includes(profileUid)) {
    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
    await myRef.update({
      blocked: firebase.firestore.FieldValue.arrayRemove(profileUid)
    });
    document.getElementById('blockBtn').innerHTML = 'üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
    document.getElementById('blockBtn').classList.remove('success');
  } else {
    // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
    await myRef.update({
      blocked: firebase.firestore.FieldValue.arrayUnion(profileUid),
      friends: firebase.firestore.FieldValue.arrayRemove(profileUid)
    });
    document.getElementById('blockBtn').innerHTML = '‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å';
    document.getElementById('blockBtn').classList.add('success');
    document.getElementById('friendBtn').innerHTML = 'ü§ù –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑–µ–π';
    document.getElementById('friendBtn').classList.remove('danger');
  }
}

function writeFromProfile(){
  back();
  openChat(profileUid);
}

/* –ú–û–ô –ü–†–û–§–ò–õ–¨ */
async function openMyProfile(){
  const d = await db.collection("users").doc(auth.currentUser.uid).get();
  const u = d.data();
  
  document.getElementById('myUsername').value = u.username || "";
  document.getElementById('myBio').value = u.bio || "";
  document.getElementById('myAvatarCustom').value = u.avatar || "üë§";
  document.getElementById('myAvatarPreview').textContent = u.avatar || "üë§";
  document.getElementById('showOnline').checked = u.showOnline !== false;
  document.getElementById('allowMessages').checked = u.allowMessages !== false;
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
  selectedStatus = u.status || 'online';
  const statusText = {
    'online': 'üü¢ –í —Å–µ—Ç–∏',
    'busy': 'üü° –ó–∞–Ω—è—Ç',
    'away': 'üü† –û—Ç–æ—à–µ–ª',
    'invisible': '‚ö™ –ù–µ–≤–∏–¥–∏–º–∫–∞'
  };
  document.getElementById('myStatusPreview').textContent = statusText[selectedStatus];
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
  document.querySelectorAll('#statusSelector .status-option').forEach(option => {
    option.classList.remove('selected');
    if (option.textContent.includes(statusText[selectedStatus].substring(2))) {
      option.classList.add('selected');
    }
  });
  
  // –í—ã–±–∏—Ä–∞–µ–º –∞–≤–∞—Ç–∞—Ä
  document.querySelectorAll('#avatarSelector .avatar-option').forEach(option => {
    option.classList.remove('selected');
    if (option.textContent === u.avatar) {
      option.classList.add('selected');
    }
  });
  
  show("myProfile");
}

// –ö–∞—Å—Ç–æ–º–Ω—ã–π –∞–≤–∞—Ç–∞—Ä
document.getElementById('myAvatarCustom').oninput = function() {
  document.getElementById('myAvatarPreview').textContent = this.value || "üë§";
};

async function updateMyProfile(){
  const updateData = {
    avatar: document.getElementById('myAvatarCustom').value || selectedAvatar,
    username: document.getElementById('myUsername').value,
    bio: document.getElementById('myBio').value,
    status: selectedStatus,
    showOnline: document.getElementById('showOnline').checked,
    allowMessages: document.getElementById('allowMessages').checked
  };
  
  await db.collection("users").doc(auth.currentUser.uid).update(updateData);
  
  me.innerText = `${updateData.avatar} ${updateData.username}`;
  back();
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
async function showMyStats() {
  const d = await db.collection("users").doc(auth.currentUser.uid).get();
  const u = d.data();
  
  alert(`üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n\n` +
        `–°–æ–æ–±—â–µ–Ω–∏–π: ${u.stats?.messages || 0}\n` +
        `–ü–æ—Å—Ç–æ–≤: ${u.stats?.posts || 0}\n` +
        `–î—Ä—É–∑–µ–π: ${u.stats?.friends || 0}\n` +
        `–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${u.createdAt ? new Date(u.createdAt).toLocaleDateString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
async function exportMyData() {
  const d = await db.collection("users").doc(auth.currentUser.uid).get();
  const data = d.data();
  
  // –°–æ–∑–¥–∞–µ–º JSON —Ñ–∞–π–ª
  const dataStr = JSON.stringify(data, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `chatnet_data_${new Date().getTime()}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
async function deleteAccount() {
  if (confirm("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!\n\n–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ: –ø—Ä–æ—Ñ–∏–ª—å, —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ—Å—Ç—ã.\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã?")) {
    if (confirm("–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –ù–∞–ø–∏—à–∏—Ç–µ '–£–î–ê–õ–ò–¢–¨' –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:")) {
      // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
      alert("–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ");
    }
  }
}

/* CHAT, SEND, REPLY, EMOJI */
function openChat(uid){
  currentChat = cid(auth.currentUser.uid, uid);
  if(unsub) unsub();
  unsub = db.collection("chats").doc(currentChat).collection("messages").orderBy("time").onSnapshot(s => {
    chat.innerHTML = "";
    s.forEach(d => {
      const m = d.data();
      const timeStr = new Date(m.time).toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
      let statusIcon = '';
      if (m.uid === auth.currentUser.uid) {
        if (m.status === 'sending') statusIcon = 'üîÑ';
        else if (m.status === 'delivered') statusIcon = '‚úì';
        else if (m.status === 'read') statusIcon = 'üëÅÔ∏è‚úì';
        else if (m.status === 'error') statusIcon = '‚ùå';
        else statusIcon = '‚úì';
      }
      chat.innerHTML += `
        <div class="msg ${m.uid === auth.currentUser.uid ? "me" : ""}" onclick="reply('${m.text.replace(/'/g, "\\'")}')">
          ${m.replyTo ? `<div class="reply-preview">‚Ü© ${m.replyTo}</div>` : ""}
          ${m.text}
          <small>${timeStr} ${statusIcon}</small>
        </div>`;
    });
    chat.scrollTop = chat.scrollHeight;
    markMessagesAsRead(uid);
  });
}

async function send(){
  if(!currentChat || !text.value) return;
  const messageId = `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  const messageData = {
    uid: auth.currentUser.uid,
    text: text.value,
    replyTo: replyMsg,
    time: Date.now(),
    status: 'sending',
    messageId: messageId
  };
  try {
    await db.collection("chats").doc(currentChat).collection("messages").doc(messageId).set(messageData);
    await db.collection("chats").doc(currentChat).collection("messages").doc(messageId).update({ status: 'delivered' });
    text.value = "";
    cancelReply();
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
    await db.collection("users").doc(auth.currentUser.uid).update({
      'stats.messages': firebase.firestore.FieldValue.increment(1)
    });
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", error);
    try {
      await db.collection("chats").doc(currentChat).collection("messages").doc(messageId).update({ status: 'error' });
    } catch (e) {}
  }
}

async function markMessagesAsRead(uid) {
  const chatId = cid(auth.currentUser.uid, uid);
  try {
    const snapshot = await db.collection("chats").doc(chatId).collection("messages")
      .where("uid", "==", uid).where("status", "in", ["sending", "delivered"]).get();
    const batch = db.batch();
    snapshot.forEach(doc => {
      const ref = db.collection("chats").doc(chatId).collection("messages").doc(doc.id);
      batch.update(ref, { status: 'read' });
    });
    if (snapshot.size > 0) await batch.commit();
  } catch (error) {}
}

function reply(t){ 
  replyMsg = t; 
  replyText.innerText = t; 
  replyBox.classList.remove("hidden"); 
}

function cancelReply(){ 
  replyMsg = null; 
  replyBox.classList.add("hidden"); 
}

function toggleEmoji(){ 
  emojiPanel.classList.toggle("hidden"); 
}

function addEmoji(e){ 
  text.value += e; 
  text.focus(); 
}

/* NEWS */
function loadPosts(){
  db.collection("posts").orderBy("time","desc").onSnapshot(s => {
    posts.innerHTML = "";
    s.forEach(d => {
      const p = d.data();
      posts.innerHTML += `<div class="post"><b>${p.username}</b><br>${p.text}</div>`;
    });
  });
}

async function createPost(){
  if(!postText.value) return;
  await db.collection("posts").add({
    username: me.innerText,
    text: postText.value,
    time: Date.now(),
    uid: auth.currentUser.uid
  });
  postText.value = "";
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å—Ç–æ–≤
  await db.collection("users").doc(auth.currentUser.uid).update({
    'stats.posts': firebase.firestore.FieldValue.increment(1)
  });
}

/* FRIENDS */
function loadFriends(){
  db.collection("users").onSnapshot(s => {
    friendsList.innerHTML = "";
    s.forEach(d => {
      if(d.id !== auth.currentUser.uid){
        const u = d.data();
        let statusText = '';
        if (u.status === 'invisible') {
          statusText = '‚ö™ –ù–µ –≤ —Å–µ—Ç–∏';
        } else if (u.online && u.showOnline !== false) {
          statusText = `üü¢ ${getStatusText(u.status || 'online')}`;
        } else {
          statusText = `‚ö™ –±—ã–ª(–∞) ${formatLastSeen(u.lastSeen)}`;
        }
        friendsList.innerHTML += `
        <div class="user" onclick="openProfile('${d.id}')">
          <div class="avatar">${u.avatar || "üë§"}</div>
          <div class="user-info">
            <div>${u.username}</div>
            <div class="status">${statusText}</div>
          </div>
        </div>`;
      }
    });
  });
}

/* UI */
function show(id){
  ["auth","profileSetup","main","profileView","myProfile"].forEach(x => document.getElementById(x).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function back(){ 
  show("main"); 
}

function startLastSeenUpdater() {
  setInterval(async () => {
    if (auth.currentUser) {
      try {
        await db.collection("users").doc(auth.currentUser.uid).update({
          lastSeen: Date.now()
        });
      } catch (error) {}
    }
  }, 30000);
}

async function logout(){
  if (auth.currentUser) {
    await db.collection("users").doc(auth.currentUser.uid).update({
      online: false,
      lastSeen: Date.now(),
      status: 'offline'
    });
  }
  auth.signOut();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤
document.addEventListener('DOMContentLoaded', function() {
  const checkboxes = document.querySelectorAll('input[type="checkbox"]');
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      if(this.checked) {
        this.style.background = '#3b82f6';
        this.style.borderColor = '#3b82f6';
      } else {
        this.style.background = 'rgba(30, 41, 59, 0.8)';
        this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
      }
    });
  });
});
</script>
</body>
</html>
